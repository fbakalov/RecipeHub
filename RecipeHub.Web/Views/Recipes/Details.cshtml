@model RecipeHub.Services.Models.RecipeDetailsModel
@using System.Security.Claims

@{
    ViewData["Title"] = Model.Title;

    var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
    bool canEdit = User.IsInRole("Admin") || userId == Model.AuthorId;
}

<div class="container mt-4">

    <div class="card shadow-lg">

        @if (!string.IsNullOrWhiteSpace(Model.ImagePath))
        {
            <img src="@Model.ImagePath"
                 class="card-img-top"
                 alt="@Model.Title"
                 style="max-height: 400px; object-fit: cover;">
        }

        <div class="card-body">

            <h2 class="card-title mb-3">@Model.Title</h2>

            <p class="text-muted">
                <strong>Category:</strong> @Model.Category
            </p>

            <hr />

            <h4>Instructions</h4>
            <p style="white-space: pre-line;">
                @Model.Instructions
            </p>

            <hr />

            <h4>Ingredients</h4>
            <ul class="list-group list-group-flush">
                @foreach (var ingredient in Model.Ingredients)
                {
                    <li class="list-group-item">
                        @ingredient
                    </li>
                }
            </ul>

            <br />

            @if (canEdit)
            {
                <a asp-action="Edit"
                   asp-route-id="@Model.Id"
                   class="btn btn-warning">
                    Edit
                </a>

                <form asp-action="Delete"
                      asp-route-id="@Model.Id"
                      method="post"
                      style="display:inline;">
                    <button type="submit"
                            class="btn btn-danger"
                            onclick="return confirm('Are you sure you want to delete this recipe?')">
                        Delete
                    </button>
                </form>
            }

            <a asp-action="Index" class="btn btn-secondary">
                Back to List
            </a>

        </div>
    </div>

</div>
